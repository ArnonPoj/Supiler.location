<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Map + Supplier Form</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <style>
        #map { height: 60vh; width: 100%; margin-bottom: 1rem; }
        form { max-width: 500px; margin: auto; }
        label { display: block; margin-top: 10px; font-weight: bold; }
        input, textarea {
            width: 100%;
            padding: 5px;
            box-sizing: border-box;
        }
        .btn-submit {
            margin-top: 15px;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            font-weight: bold;
            border: none;
            cursor: pointer;
            width: 100%;
        }
    </style>
</head>
<body>

    <h2 style="text-align: center;">ปักหมุด + กรอกข้อมูล Supplier</h2>
    <div id="map"></div>

    <form method="POST" action="/submit">
        <label>ชื่อ Supplier:</label>
        <input type="text" name="name" required>

        <label>ที่อยู่:</label>
        <textarea name="address" rows="2"></textarea>

        <label>ที่อยู่สำหรับใช้ปักหมุด (พิกัด lat,lng):</label>
        <input type="text" name="latlng" id="latlng" readonly required>

        <label>ชื่อผู้ติดต่อ:</label>
        <input type="text" name="contact_person">

        <label>เบอร์โทร:</label>
        <input type="text" name="phone">

        <button class="btn-submit" type="submit">บันทึก</button>
    </form>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script>
        const map = L.map('map').setView([13.7563, 100.5018], 12);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 18,
            attribution: '© OpenStreetMap'
        }).addTo(map);

        let marker;

        map.on('click', function(e) {
            const lat = e.latlng.lat.toFixed(5);
            const lng = e.latlng.lng.toFixed(5);

            // ถ้ามีหมุดเดิม → ลบทิ้งก่อน
            if (marker) {
                map.removeLayer(marker);
            }

            marker = L.marker([lat, lng]).addTo(map)
                .bindPopup("คุณเลือกพิกัดนี้:<br>" + lat + ", " + lng)
                .openPopup();

            // ใส่พิกัดลงในช่อง input
            document.getElementById("latlng").value = `${lat}, ${lng}`;
        });
    </script>
</body>
</html>
